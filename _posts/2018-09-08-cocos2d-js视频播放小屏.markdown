---
layout: post
title: cocos2d-js è§†é¢‘å°å±æ’­æ”¾
date: 2018-09-08 15:59:28.000000000 +09:00
---

## é—®é¢˜

åœ¨å¤§å­¦çš„æ—¶å€™ï¼Œåšè¿‡ `cocos2d-x` å¼€å‘ï¼Œè¿™æ¬¡æœ‰ä¸ªå°é¡¹ç›®ï¼Œå°±å‡†å¤‡ç”¨ cocos2d-js å†™ï¼Œç”¨æ³•éƒ½å·®ä¸å¤šï¼Œè¯­è¨€ä¸ä¸€æ ·è€Œå·²ã€‚ è¿™æ¬¡è¿˜æ˜¯ç¢°åˆ°äº†ä¸€äº›å‘ï¼Œè®°å½•ä¸‹è¸©å‘è¿‡ç¨‹ï¼

ç„¶åé‡Œé¢ç”¨åˆ°è§†é¢‘æ’­æ”¾ç»„ä»¶çš„æ—¶å€™ï¼Œå‘ç°å‡ºäº†ä¸€äº›é—®é¢˜ï¼Œä¸å¾—ä¸è¯´ï¼Œ`cocos` çš„å‘è¿˜æ˜¯ä¸å°‘çš„ ğŸ˜‚

éƒ½çŸ¥é“å¾®ä¿¡h5ä¸­è®¾ç½®è§†é¢‘å°å±æ’­æ”¾çš„ç­–ç•¥ï¼Œç»™`video` æ ‡ç­¾åŠ å±æ€§ã€‚

ä½†æ˜¯åœ¨`cocos2d`å¼•æ“é‡Œä¸æ€ä¹ˆå¥½åŠ å•Šï¼

æ·±å…¥åˆ° `cocos2djs` çš„å¼•æ“ä»£ç ï¼ŒæŸ¥çœ‹å®ƒå†…éƒ¨æ˜¯æ€ä¹ˆè®¾ç½®å±æ€§çš„ï¼Œçœ‹åˆ°å¯ä»¥æ·»åŠ ä¸€äº›æ ·å¼ï¼Œä½†æ˜¯æˆ‘è¦çš„é‚£äº›å±æ€§å´æ·»åŠ ä¸äº†ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘çš„å§¿åŠ¿ä¸å¯¹ã€‚

ç ”ç©¶äº†å¤§æ¦‚ä¸€å¤©å§ï¼Œåæ¥æƒ³åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œè¿˜æ˜¯ä¸åœ¨å¼•æ“æºç é‡ŒåŠ¨æ‰‹è„šäº†ã€‚


## è§£å†³

åœ¨æ·»åŠ å®Œ `videoPlayer` ç»„ä»¶ä¹‹åï¼Œåˆ©ç”¨åŸç”Ÿ`js `å¯¹`dom`è¿›è¡Œæ“ä½œã€‚ç»™ `video` æ ‡ç­¾åŠ¨æ€æ·»åŠ å±æ€§ã€‚è¿™ä¸ªæƒ³æ³•è¯´å‡ºæ¥æœ‰ç‚¹æ™®é€šï¼Œä½†æ˜¯å½“æ—¶çœŸçš„æ²¡æƒ³åˆ°å•Šï¼ ä»£ç å¦‚ä¸‹ï¼š

***åˆ›å»º `videoPlayer` ç»„å»º***

```
var player = new ccui.VideoPlayer(res.s_video)
this.addChild(player, 1, 1)
this.videoPlayer_ = player
player.setContentSize(395, 290)
player.setPosition(g_size.width * 0.5, -145)
var that = this
player.setEventListener(ccui.VideoPlayer.EventType.COMPLETED, function () {
    console.log("over")
})

geek_game_setup_video()

```

***åŠ¨æ€ä¿®æ”¹ `video` æ ‡ç­¾çš„å±æ€§***

```
function geek_game_setup_video() {
    var video = document.getElementsByClassName("cocosVideo")[0]
    if (video) {
        video.setAttribute("webkit-playsinline", "true")
        video.setAttribute("playsinline", "true")
        
        video.setAttribute("x5-playsinline", "true")
        video.setAttribute("x5-video-player-type", "h5")
//            video.setAttribute("x5-video-orientation", "portraint")
//            video.setAttribute("x5-video-player-fullscreen", "true")
        video.setAttribute("controls", "true")
    }
}
```

å‰é¢ä¸¤ä¸ªå±æ€§ `webkit-playsinline` å’Œ `playsinline` ä¼šåœ¨è‹¹æœæ‰‹æœºä¸Šèµ·ä½œç”¨ï¼Œ ä¸‹é¢çš„æ˜¯å®‰å“ç«¯å¾®ä¿¡å¯¹å†…ç½®` x5` æµè§ˆå™¨çš„é€‚é…ã€‚

## å»¶ä¼¸

ç”±äºè®¾ç½®äº† `controls` æ ‡ç­¾ï¼Œ æ’­æ”¾å™¨ä¼šæ˜¾ç¤ºä¸€äº›å†…ç½®çš„ç»„ä»¶ï¼Œæ¯”å¦‚æ’­æ”¾ï¼Œå¿«è¿›ï¼Œå…¨å±è¿™äº›ã€‚
æ‰€ä»¥æˆ‘åˆè¦éšè—å…¨å±çš„æŒ‰é’®ã€‚

åœ¨`css` æ ·å¼ä¸Šï¼Œæ·»åŠ å¦‚ä¸‹ï¼š

```
video::-webkit-media-controls-fullscreen-button {
    display: none;
}

```

è¿™æ ·å°± `ok` äº†


## åç»­

åœ¨å®‰å“æ‰‹æœºä¸Šè®¿é—®ä¼šå‘ç°ï¼Œéå¸¸æ¨¡ç³Šï¼Œè¦è¯´åˆ†è¾¨ç‡ä¸å¤Ÿï¼Œä¹Ÿåº”è¯¥æ˜¯ `iphone` ä¸Šæ¨¡ç³Šå‘€ã€‚

æŸ¥åˆ°ç½‘ä¸Šæœ‰ä»¥ä¸‹ä¿®æ”¹æ–¹å¼

åŸå¼•æ“ä»£ç å¦‚ä¸‹ï¼š

```
var devicePixelRatio = view._devicePixelRatio = 1;
if (view.isRetinaEnabled())
    devicePixelRatio = view._devicePixelRatio = window.devicePixelRatio || 1;
```

åœ¨å®‰å“ä¸Šï¼Œ`devicePixelRatio` ä¼šèƒŒè®¾ç½®ä¸º 1ï¼Œ å¯¼è‡´æ˜¾ç¤ºæ¨¡ç³Šï¼Œ æ‰€ä»¥æŠŠä¸Šé¢ç›´æ¥ä¿®æ”¹ä¸ºï¼š

```
devicePixelRatio = view._devicePixelRatio = window.devicePixelRatio || 1;
```

å°±å¯ä»¥æ¸…æ¥šçš„æ˜¾ç¤ºäº†

### ä½†æ˜¯ï¼

å‰é¢è¯´åˆ°çš„ `videoPlayer` ç»„ä»¶ä¸æ˜¾ç¤ºäº†ï¼  
çŒœæƒ³æ˜¯è®¾ç½® `devicePixelRatio ` çš„åŸå› ã€‚

æŸ¥çœ‹æºç å‘ç°ï¼ŒvideoPlayer å†…éƒ¨ä¹Ÿå¼•ç”¨åˆ°äº† `view.isRetinaEnabled()` åˆ¤æ–­æ¥ç»˜å›¾ï¼Œæ‰€ä»¥ä¸Šé¢è®¾ç½® devicePixelRatio å’Œ è¿™è¾¹äº§ç”Ÿäº†å†²çªã€‚  
æŠŠä¸Šé¢çš„ä»£ç æ¢å¤äº†ï¼Œåæ¥åˆæ‰¾åˆ°å¦ä¸€ç§æ–¹æ³•å¯ä»¥ç»Ÿä¸€è®¾ç½®ã€‚åœ¨å¼•æ“ä»£ç å®Œå…¨å¯åŠ¨åï¼Œè®¾ç½®å¦‚ä¸‹:

```
cc.view.enableRetina(true)
```

è¿™æ ·åœ¨å®‰å“ä¸Šä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºäº†ã€‚