---
layout: post
title: EOS æ­å»ºç½‘ç»œ
date: 2018-06-14 15:59:28.000000000 +09:00
---

## å®‰è£…æœ¬åœ°ç¯å¢ƒ

### ä¸‹è½½ä»£ç 

ä¸‹è½½æœ€æ–°ä»£ç ï¼Œ`master` åˆ†æ”¯å³å¯,`--recursive` ä¼šæŠŠ`submodule` ä¹Ÿä¸€èµ·ä¸‹è½½ä¸‹æ¥

`git clone https://github.com/EOSIO/eos --recursive`


### ç¼–è¯‘å®‰è£…
åˆ‡æ¢åˆ°eos ç›®å½•ï¼Œæ‰§è¡Œ eosio_build.sh è„šæœ¬

```
cd eos
./eosio_build.sh
```
æœ€åå‡ºç° `EOSIO` å‡ ä¸ªè¶…å¤§çš„å­—æ¯å°±æ˜¯`OK` äº†ã€‚

### éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ

`Linux:`

`~/opt/mongodb/bin/mongod -f ~/opt/mongodb/mongod.conf &`

`MacOS:`

`/usr/local/bin/mongod -f /usr/local/etc/mongod.conf &`

```
cd build
make test
```

è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰ä¸€æ®µæ—¶é—´ã€‚

### å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶
```
cd build
sudo make install
```
è¿™ä¸ªä¼šæŠŠä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶æ¯”å¦‚`nodeos`ï¼Œ`cleos` æ‹·è´åˆ° `/usr/local` ç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•åœ¨å½“å‰çš„`PATH`ä¸­ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤èµ·æ¥ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚

## ç»“æ„
* `nodeos`ï¼š åŒºå—é“¾æœåŠ¡å™¨èŠ‚ç‚¹ç”Ÿæˆç»„å»º
* `cleos`ï¼š å’ŒåŒºå—é“¾äº¤äº’çš„æ¥å£å‘½ä»¤
* `keosd`ï¼š `EOS` é’±åŒ…

## `nodeos`

### å¯åŠ¨å•ä¸ªèŠ‚ç‚¹

**`nodeos`** æ˜¯åŒºå—é“¾æœåŠ¡å™¨èŠ‚ç‚¹ç”Ÿæˆç»„å»ºã€‚

å¯åŠ¨å•ä¸ªåŒºå—é“¾æœåŠ¡å™¨èŠ‚ç‚¹ï¼š

`nodeos -e -p eosio --plugin eosio::chain_api_plugin --plugin eosio::history_api_plugin `

* `-p` æ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„åç§°
* `--plugin` æ˜¯å¯åŠ¨èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦ä¸€èµ·ä½¿ç”¨åˆ°çš„æ’ä»¶æœåŠ¡

nodeos æˆåŠŸè¿è¡Œçš„è¯ï¼Œåº”è¯¥æœ‰å¦‚ä¸‹log,å³å·²ç»å¼€å§‹å‡ºå—äº†ï¼Œ`signed by eosio [trxs: 0, lib: 0, confirmed: 0]` è¡¨ç¤ºå—é‡Œè¿˜æ²¡æœ‰äº¤æ˜“ã€‚`Ctrl-C` å¯ä»¥åœæ­¢è¿›ç¨‹ã€‚

```
2243857ms thread-0   http_plugin.cpp:342           add_handler          ] add api url: /v1/history/get_transaction
2243857ms thread-0   net_plugin.cpp:2903           plugin_startup       ] starting listener, max clients is 25
2244008ms thread-0   producer_plugin.cpp:942       produce_block        ] Produced block 000000029ff16f71... #2 @ 2018-06-13T08:37:24.000 signed by eosio [trxs: 0, lib: 0, confirmed: 0]
2244506ms thread-0   producer_plugin.cpp:942       produce_block        ] Produced block 00000003c5c6b8f4... #3 @ 2018-06-13T08:37:24.500 signed by eosio [trxs: 0, lib: 2, confirmed: 0]
```

### é«˜çº§è®¾ç½®

å¦‚æœä½ è§‰å¾—å¯åŠ¨ **`nodeos`** çš„æ—¶å€™ï¼Œå‚æ•°å¤ªå¤šï¼Œè®°ä¸æ¸…ã€‚å¯ä»¥å°†å‚æ•°å¡«åˆ°é…ç½®æ–‡ä»¶`config.ini`ä¸­ã€‚
> `config.ini` æ–‡ä»¶ä¸æ˜¯ä¸€å¼€å§‹å°±æœ‰çš„ï¼Œå½“ç¬¬ä¸€æ¬¡å¯åŠ¨nodeos æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ° `config.ini`ï¼Œå°±ä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ï¼Œæ–‡ä»¶ä½ç½®å¦‚ä¸‹

```
Mac OS: ~/Library/Application Support/eosio/nodeos/config/config.ini
Linux: ~/.local/share/eosio/nodeos/config/config.ini
```

åœ¨ `config.ini` ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®:

```
enable-stale-production = true
# Enable block production with the testnet producers
producer-name = eosio 
# Load the block producer plugin, so you can produce blocks
plugin = eosio::producer_plugin
# Wallet plugin
plugin = eosio::wallet_api_plugin
# As well as API and HTTP plugins
plugin = eosio::chain_api_plugin
plugin = eosio::http_plugin
# This will be used by the validation step below, to view account history
plugin = eosio::history_api_plugin
```

> æ³¨æ„ï¼šæ³¨é‡Šæ‰`config.ini `å†…å…ˆå‰çš„é…ç½®`enable-stale-production = false`


**å†æ¬¡å¯åŠ¨åªéœ€è¾“å…¥ `nodeos` å°±ğŸ‘Œäº†ã€‚**

åŒºå—é“¾çš„æ•°æ®å­˜æ”¾è·¯å¾„å¦‚ä¸‹

```
Mac OS: ~/Library/Application Support/eosio/nodeos/data
Linux: ~/.local/share/eosio/nodeos/data
```
å¦‚æœé‡å¯`nodeos` å¤±è´¥ï¼Œå¯ä»¥åˆ é™¤ä¹‹å‰çš„`data`æ•°æ®.



## `cleos(client-eos)`

å‰é¢çš„`nodeos`ä¼šåœ¨`8888`ç«¯å£å¼€å¯ä¸€ä¸ª`http`æœåŠ¡ã€‚   
`cleos` æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·ï¼Œå†…éƒ¨å…¶å®æ˜¯å°è£…ä»ç»ˆç«¯ä¼ è¿›å»çš„å‚æ•°ï¼Œç„¶åå‘é€è¯·æ±‚ç»™ `nodeos`,æ‹¿åˆ°è¿”å›å€¼åï¼Œç»è¿‡å¤„ç†å†è¾“å‡ºåˆ°ç»ˆç«¯ã€‚

### æŸ¥çœ‹èŠ‚ç‚¹çš„çŠ¶æ€

`cleos get info `  
æˆ–è€…  
`cleos -u http://localhost:8888 get info`

```json
{
  "server_version": "07a67985",
  "chain_id": "706a7ddd808de9fc2b8879904f3b392256c83104c1d544b38302cc07d9fca477",
  "head_block_num": 8, // èŠ‚ç‚¹åŒºå—æ•°é‡
  "last_irreversible_block_num": 7,
  "last_irreversible_block_id": "00000007e45264c9bc7d24d5c655b20336a6ea4d8fa0adfbaf0120a3874a373f",
  "head_block_id": "0000000890033e629074ecc2c492e2ff483adb46ad942cc0e81dacd7901c9593",
  "head_block_time": "2018-06-13T08:37:27",
  "head_block_producer": "eosio", // ç”Ÿäº§è€…èŠ‚ç‚¹åç§°
  "virtual_block_cpu_limit": 201403,
  "virtual_block_net_limit": 1055940,
  "block_cpu_limit": 199900,
  "block_net_limit": 1048576
}
```

### åˆ›å»ºé’±åŒ…

```
//åˆ›å»ºé»˜è®¤é’±åŒ…
cleos wallet create 
//åˆ›å»º jack çš„é’±åŒ…
cleos wallet create -n jack 
```
è¦ä¿å­˜ä¸€ä¸‹é’±åŒ…çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š`PW5JR33BmijnjWC8Ye8qDoJG7zUdrjk6GZMAjsEuVbG78oDQUFyKz`

```
Creating wallet: jack
Save password to use in the future to unlock this wallet.
Without password imported keys will not be retrievable.
"PW5JR33BmijnjWC8Ye8qDoJG7zUdrjk6GZMAjsEuVbG78oDQUFyKz"
```

### åˆ›å»º`key`

```
âœ  eos git:(master) âœ—cleos create key
Private key: 5KiHiPpgUQmb3RdiV8FqV78xyXkZ4A7oKPfG2aJY9DTxHjXrbcV
Public key: EOS6kQMgyLcR1Y326VtiGBEqbnvH5i3B2wAATcoQ6qqsYQ2KGGCh9
```

### å°†å¯†é’¥å¯¼å…¥é’±åŒ…

```
âœ  eos git:(master) âœ— cleos wallet import -n jack 5KiHiPpgUQmb3RdiV8FqV78xyXkZ4A7oKPfG2aJY9DTxHjXrbcV
imported private key for: EOS6kQMgyLcR1Y326VtiGBEqbnvH5i3B2wAATcoQ6qqsYQ2KGGCh9
```

### æ˜¾ç¤ºæ‰€æœ‰çš„å¯†é’¥
ä¼šæ˜¾ç¤ºæ‰€æœ‰***æ²¡æœ‰è¢«é”ä¸Š***çš„é’±åŒ…çš„å¯†é’¥

```
âœ  eos git:(master) âœ— cleos wallet keys
[[
    "EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV",
    "5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3"
  ],[
    "EOS6kQMgyLcR1Y326VtiGBEqbnvH5i3B2wAATcoQ6qqsYQ2KGGCh9",
    "5KiHiPpgUQmb3RdiV8FqV78xyXkZ4A7oKPfG2aJY9DTxHjXrbcV"
  ]
]
```

### æŸ¥çœ‹é’±åŒ…åˆ—è¡¨
```
âœ  eos git:(master) âœ— cleos wallet list
Wallets:
[
  "default",
  "jack *"
]
```
ç›®å‰æœ‰`default`é’±åŒ…å’Œ`jack`é’±åŒ…ï¼Œ `jack`åé¢çš„`*` ä»£è¡¨è¿™ä¸ªé’±åŒ…å¯ç”¨ï¼ˆæ²¡æœ‰è¢«é”ï¼‰ã€‚

### åˆ›å»ºç”¨æˆ·

åˆ›å»ºç”¨æˆ· `jack.token`

```
âœ  eos git:(master) âœ— cleos create account eosio jack.token \
EOS6kQMgyLcR1Y326VtiGBEqbnvH5i3B2wAATcoQ6qqsYQ2KGGCh9 \
EOS6kQMgyLcR1Y326VtiGBEqbnvH5i3B2wAATcoQ6qqsYQ2KGGCh9

executed transaction: 008185163cfa269f55c8f080aa4281b5b2e192ba0569caa8a41a7aca983d0d4a  200 bytes  128584 us
#         eosio <= eosio::newaccount            {"creator":"eosio","name":"jack.token","owner":{"threshold":1,"keys":[{"key":"EOS6kQMgyLcR1Y326VtiGB...
3564487ms thread-0   main.cpp:381                  print_result  warning: transaction executed locally, but may not be confirmed by the network yet
```
å‚æ•°è¯´æ˜
`cleos create account [creator] [accountname] [OwnerKey] [ActiveKey]`  


### åŠ è½½biosåˆçº¦
```
cleos set contract eosio build/contracts/eosio.bios -p eosio

Reading WAST/WASM from build/contracts/eosio.bios/eosio.bios.wasm...
Using already assembled WASM...
Publishing contract...
executed transaction: 27065fadf93030fd6289da8f6f86824b7188e8f7ca3cb947e48fafa19bcef1fb  3720 bytes  4449 us
#         eosio <= eosio::setcode               {"account":"eosio","vmtype":0,"vmversion":0,"code":"0061736d0100000001621260037f7e7f0060057f7e7e7e7e...
#         eosio <= eosio::setabi                {"account":"eosio","abi":"0e656f73696f3a3a6162692f312e30050c6163636f756e745f6e616d65046e616d650f7065...
warning: transaction executed locally, but may not be confirmed by the network yet

```

### ç»™`account`è®¾ç½®`contract`
ä¸ºè´¦æˆ· `jack.token` è®¾ç½® `eosio.token` åˆçº¦

```
cleos set contract jack.token build/contracts/eosio.token -p jack.token

Reading WAST/WASM from build/contracts/eosio.token/eosio.token.wasm...
Using already assembled WASM...
Publishing contract...
executed transaction: 3ef8e558d936a7828dfa069323ec29c52031da6af46114f53e777435e15aa1b6  8104 bytes  21033 us
#         eosio <= eosio::setcode               {"account":"jack.token","vmtype":0,"vmversion":0,"code":"0061736d01000000017e1560037f7e7f0060057f7e7...
#         eosio <= eosio::setabi                {"account":"jack.token","abi":"0e656f73696f3a3a6162692f312e30010c6163636f756e745f6e616d65046e616d650...
warning: transaction executed locally, but may not be confirmed by the network yet

```
### æŸ¥çœ‹è´¦æˆ·çš„åˆçº¦
```
cleos get code jack.token

code hash: 641f336aa1d08526201599c3c0ddb7a646e5ac8f9fd2493f56414d0422a0f957
```
åªè¦`hash` å€¼ä¸ä¸º 0ï¼Œå°±æ˜¯å·²ç»æœ‰åˆçº¦äº†ã€‚

### åˆ›å»ºä»£å¸

```
cleos push action jack.token create '["eosio","1000000000.0000 EOS",0,0,0]' -p jack.token

executed transaction: b29f5769319dc3b854acec8a7617fd87a15e180fdb3193f13ac03cd82a702e8f  120 bytes  1363 us
#    jack.token <= jack.token::create           {"issuer":"eosio","maximum_supply":"1000000000.0000 EOS"}
```
`-p jack` ä»£è¡¨ä»¥`jack`çš„èº«ä»½æ‰§è¡Œçš„ï¼Œå› ä¸ºè¿™ä¸ªåˆçº¦çš„æ‰€æœ‰è€…æ˜¯`jack`ã€‚

### ç»™eosio å‘å¸

```
cleos push action jack.token issue '["eosio","1000000000.0000 EOS","issue"]' -p eosio
```
ç»™`eosio`å‘äº†1000000000.0000 ä¸ª EOS

### è½¬è´¦
```
cleos push action jack.token transfer '["eosio", "jack.token","50000.0000 EOS","trans"]' -p eosio

executed transaction: 5909733736cf6f55990ee59b3187253e55eaa9a9e5d248ffc7e3c206f6a2accc  136 bytes  2650 us
#    jack.token <= jack.token::transfer         {"from":"eosio","to":"jack.token","quantity":"50000.0000 EOS","memo":"trans"}
#         eosio <= jack.token::transfer         {"from":"eosio","to":"jack.token","quantity":"50000.0000 EOS","memo":"trans"}
```
ä»`eosio`è½¬`50000`ä¸ª`EOS`ç»™`jack.token`å¸æˆ·

### æŸ¥çœ‹ä½™é¢
```
cleos get currency balance jack.token eosio
999950000.0000 EOS

cleos get currency balance jack.token jack.token
50000.0000 EOS
```